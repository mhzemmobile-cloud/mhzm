<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ù‚Ø¯ Ù…Ø­Ø²Ù… Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- DESIGN SYSTEM (Screen) --- */
        :root { --primary: #0056b3; --bg: #121212; --surface: #1e1e1e; --text: #e0e0e0; }
        
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; }
        
        body {
            background-color: var(--bg); color: var(--text);
            min-height: 100vh; display: flex; justify-content: center; align-items: flex-start; padding: 20px;
        }

        .container {
            width: 100%; max-width: 850px; background: var(--surface);
            border-radius: 12px; border: 1px solid #333; overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        /* --- PRINT SYSTEM (Strict Paper Mode) --- */
        @media print {
            body { background: #fff !important; padding: 0 !important; margin: 0 !important; display: block !important; }
            .container { 
                box-shadow: none !important; border: none !important; 
                width: 100% !important; max-width: 100% !important; 
                background: #fff !important; color: #000 !important;
                border-radius: 0 !important; overflow: visible !important;
            }
            .no-print, .section, #adminView, #authView, #successView, .btn, .header { display: none !important; }
            
            /* Force show Contract View */
            #contractView { display: block !important; padding: 0 !important; margin: 0 !important; }
            .contract-box { 
                border: none !important; padding: 0 !important; margin: 0 !important; 
                color: #000 !important; background: transparent !important;
            }
            
            /* Logo adjustment for print */
            .print-logo { display: block !important; height: 80px; margin: 0 auto 20px; }
            
            /* Texts */
            h3, h4, p, li, span, div { color: #000 !important; text-shadow: none !important; }
            .terms-list { page-break-inside: auto; }
            
            /* Stamp */
            #signedStamp { display: flex !important; page-break-inside: avoid; }
        }

        /* Screen Elements */
        .header { background: #fff; padding: 15px; text-align: center; border-bottom: 4px solid var(--primary); }
        .header img { height: 70px; display: block; margin: 0 auto; }
        .print-logo { display: none; } /* Hidden on screen, visible on print */

        .section { display: none; padding: 25px; }
        .section.active { display: block; }

        input { width: 100%; padding: 12px; background: #252525; border: 1px solid #444; color: #fff; border-radius: 6px; margin-bottom: 15px; }
        label { color: #00d4ff; display: block; margin-bottom: 5px; font-weight: bold; }
        
        .btn { width: 100%; padding: 15px; background: var(--primary); color: #fff; border: none; border-radius: 8px; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top: 10px; }
        
        /* Contract Document Styling */
        .contract-box { background: #fff; color: #000; padding: 30px; border-radius: 8px; line-height: 1.5; }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #f8f9fa; padding: 15px; border: 1px solid #ddd; margin-bottom: 20px; border-radius: 6px; }
        .data-item span { font-weight: 800; color: #000; }
        
        .stamp-box {
            width: 140px; height: 140px; border: 3px solid var(--primary); border-radius: 50%;
            margin: 20px auto; color: var(--primary); font-weight: 900;
            display: flex; align-items: center; justify-content: center; flex-direction: column;
            transform: rotate(-15deg); background: rgba(255,255,255,0.9);
        }

        /* Big Print Button for Admin */
        #adminPrintBtn {
            background: #28a745; margin-bottom: 20px; padding: 20px; font-size: 1.3rem;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% {box-shadow: 0 0 0 0 rgba(40,167,69, 0.4);} 70% {box-shadow: 0 0 0 10px rgba(40,167,69, 0);} 100% {box-shadow: 0 0 0 0 rgba(40,167,69, 0);} }
    </style>
</head>
<body>

    <div class="container">
        <div class="header no-print">
            <img src="https://mhzm.sa/wp-content/webp-express/webp-images/uploads/2024/05/%D9%84%D9%88%D8%AC%D9%88.png.webp" alt="MHZM">
            <h2 style="color:var(--primary); margin-top:5px;">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù‚ÙˆØ¯</h2>
        </div>

        <div id="adminView" class="section">
            <h3 style="color:#00d4ff; margin-bottom:15px;">Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù‚Ø¯ Ø¬Ø¯ÙŠØ¯</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div><label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input type="text" id="cName"></div>
                <div><label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="tel" id="cPhone" placeholder="05xxxxxxxx"></div>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div><label>Ø§Ù„Ù‡ÙˆÙŠØ©</label><input type="text" id="cID"></div>
                <div><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input type="text" id="cAddr"></div>
            </div>
            <label>Ø§Ù„Ø¬Ù‡Ø§Ø² / Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ / Ø§Ù„Ù„ÙˆÙ†</label><input type="text" id="cDevice">
            <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ (IMEI)</label><input type="text" id="cIMEI">
            <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
                <div><label>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label><input type="number" id="cTotal"></div>
                <div><label>Ø§Ù„Ù‚Ø³Ø·</label><input type="number" id="cMonth"></div>
                <div><label>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label><input type="number" id="cDay" placeholder="ÙŠÙˆÙ…"></div>
            </div>

            <div style="background:#2a2a2a; padding:10px; margin-top:10px; border-radius:5px;">
                <label style="font-size:0.8rem; color:#aaa;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©)</label>
                <input type="text" id="botToken" placeholder="Bot Token" style="margin-bottom:5px;">
                <input type="text" id="chatId" placeholder="Chat ID" style="margin-bottom:0;">
            </div>

            <button onclick="genLink()" class="btn">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
        </div>

        <div id="authView" class="section">
            <div style="text-align:center; padding:40px 0;">
                <h3>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
                <p style="color:#aaa; margin-bottom:20px;">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„Ùƒ Ù„Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù‚Ø¯</p>
                <input type="tel" id="authPhone" placeholder="05xxxxxxxx" style="text-align:center; max-width:300px; margin:0 auto 15px;">
                <button onclick="verify()" class="btn" style="max-width:300px;">Ø¯Ø®ÙˆÙ„</button>
            </div>
        </div>

        <div id="contractView" class="section">
            
            <button id="adminPrintBtn" class="btn no-print" onclick="window.print()" style="display:none;">
                <i class="fas fa-print"></i> Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¹Ù‚Ø¯ (PDF)
            </button>

            <div class="contract-box">
                <img src="https://mhzm.sa/wp-content/webp-express/webp-images/uploads/2024/05/%D9%84%D9%88%D8%AC%D9%88.png.webp" class="print-logo" alt="Logo">
                
                <div style="text-align:center; border-bottom:2px solid #000; padding-bottom:15px; margin-bottom:20px;">
                    <h2 style="color:#000;">Ø§ØªÙØ§Ù‚ÙŠØ© Ø¨ÙŠØ¹ Ø¨Ø§Ù„ØªÙ‚Ø³ÙŠØ·</h2>
                    <p style="color:#333;">Ø§Ù„ØªØ§Ø±ÙŠØ®: <span id="vDate"></span></p>
                </div>

                <div class="data-grid">
                    <div>Ø§Ù„Ø¹Ù…ÙŠÙ„: <span id="vName"></span></div>
                    <div>Ø§Ù„Ù‡ÙˆÙŠØ©: <span id="vID"></span></div>
                    <div>Ø§Ù„Ø¬ÙˆØ§Ù„: <span id="vPhone"></span></div>
                    <div>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: <span id="vAddr"></span></div>
                    <div>Ø§Ù„Ø¬Ù‡Ø§Ø²: <span id="vDevice"></span></div>
                    <div>IMEI: <span id="vIMEI"></span></div>
                    <div style="grid-column:span 2;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹: Ø¥Ø¬Ù…Ø§Ù„ÙŠ <span id="vTotal"></span> Ø±ÙŠØ§Ù„ / Ù‚Ø³Ø· Ø´Ù‡Ø±ÙŠ <span id="vMonth"></span> Ø±ÙŠØ§Ù„ (ÙŠÙˆÙ… <span id="vDay"></span>)</div>
                </div>

                <div style="font-size:0.9rem; color:#000;">
                    <h4 style="margin-bottom:10px; color:#000;">Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…:</h4>
                    <ol class="terms-list" style="padding-right:20px;">
                        <li>ÙŠÙ‚Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯Ø§Ù‹ ÙˆØ¨Ø­Ø§Ù„Ø© Ø³Ù„ÙŠÙ…Ø© Ù…Ø¹ ÙƒØ§Ù…Ù„ Ù…Ù„Ø­Ù‚Ø§ØªÙ‡.</li>
                        <li>Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ø´Ù…ÙˆÙ„ Ø¨Ø¶Ù…Ø§Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ù…Ø¯Ø© Ø³Ù†ØªÙŠÙ† Ø¶Ø¯ Ø§Ù„Ø¹ÙŠÙˆØ¨ Ø§Ù„Ù…ØµÙ†Ø¹ÙŠØ©.</li>
                        <li>ÙŠÙ„ØªØ²Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø£Ø¹Ù„Ø§Ù‡.</li>
                        <li>ÙŠØ­Ù‚ Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ± Ù„ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª.</li>
                        <li>ÙŠÙ‚Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨ØµØ­Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆÙŠÙ„ØªØ²Ù… Ø¨ØªØ­Ø¯ÙŠØ«Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±.</li>
                        <li>ÙŠØ¹ØªØ¨Ø± Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ù„ÙƒØ§Ù‹ Ù„Ù„Ù…ØªØ¬Ø± Ø­ØªÙ‰ Ø³Ø¯Ø§Ø¯ ÙƒØ§Ù…Ù„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· (Ø´Ø±Ø· Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù…Ù„ÙƒÙŠØ©).</li>
                        <li>ÙÙŠ Ø­Ø§Ù„ Ø§Ù„ØªØ¹Ø«Ø± Ø¹Ù† Ø³Ø¯Ø§Ø¯ Ù‚Ø³Ø·ÙŠÙ†ØŒ ÙŠØ­Ù„ ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ÙÙˆØ±Ø§Ù‹.</li>
                        <li>Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø³ÙˆØ¡ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (ÙƒØ³Ø±/Ø³ÙˆØ§Ø¦Ù„) ÙˆÙ„Ø§ ÙŠØ¹ÙÙŠÙ‡ Ø°Ù„Ùƒ Ù…Ù† Ø§Ù„Ø³Ø¯Ø§Ø¯.</li>
                        <li>ÙŠØ­Ù‚ Ù„Ù„Ù…ØªØ¬Ø± Ø§ØªØ®Ø§Ø° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© ÙˆØ±ÙØ¹ Ø³Ù…Ø© "ØªØ¹Ø«Ø±" ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… Ø§Ù„Ø³Ø¯Ø§Ø¯.</li>
                        <li>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ø¯Ù†Ø§Ù‡ Ù…Ù„Ø²Ù… Ù‚Ø§Ù†ÙˆÙ†ÙŠØ§Ù‹ Ù†Ø§ÙØ° Ù„Ù„Ø¬Ù‡Ø§Ù„Ø©.</li>
                    </ol>
                </div>

                <div id="sigBox" class="no-print" style="margin-top:20px; background:#f4f4f4; padding:20px; text-align:center; border:1px dashed #999;">
                    <label style="color:#333;">Ù„Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ØŒ Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ:</label>
                    <input type="text" id="sigInput" style="background:#fff; color:#000; text-align:center; border:1px solid #ccc;">
                    <button onclick="sign()" class="btn">ØªÙˆÙ‚ÙŠØ¹ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯</button>
                </div>

                <div id="signedStamp" style="display:none; text-align:center; margin-top:30px;">
                    <div class="stamp-box">
                        <span>Ù…ØªØ¬Ø± Ù…Ø­Ø²Ù…</span>
                        <small>MHZM STORE</small>
                        <small style="border-top:1px solid; margin-top:2px;">ØªÙ… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</small>
                    </div>
                    <p style="color:#000; margin-top:10px;">Ø§Ù„Ù…ÙˆÙ‚Ø¹: <b id="finalSig"></b></p>
                </div>
            </div>
        </div>

        <div id="successView" class="section" style="text-align:center;">
            <h1 style="color:#28a745; font-size:4rem;">âœ“</h1>
            <h3>ØªÙ… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­</h3>
        </div>
    </div>

    <script>
        // --- Logic ---
        const encode = (d) => btoa(unescape(encodeURIComponent(JSON.stringify(d))));
        const decode = (s) => { try { return JSON.parse(decodeURIComponent(escape(atob(s)))); } catch(e){ return null; } };
        
        const params = new URLSearchParams(window.location.search);
        const cVal = params.get('c');
        const sVal = params.get('s');

        // Restore Settings
        if(localStorage.getItem('mtk')) document.getElementById('botToken').value = localStorage.getItem('mtk');
        if(localStorage.getItem('mid')) document.getElementById('chatId').value = localStorage.getItem('mid');

        // Init View
        if(cVal && sVal) {
            renderContract(cVal, sVal);
        } else if(cVal) {
            document.getElementById('authView').classList.add('active');
        } else {
            document.getElementById('adminView').classList.add('active');
        }

        // Functions
        function genLink() {
            const tk = document.getElementById('botToken').value;
            const id = document.getElementById('chatId').value;
            localStorage.setItem('mtk', tk);
            localStorage.setItem('mid', id);

            const data = {
                n: document.getElementById('cName').value,
                p: document.getElementById('cPhone').value,
                id: document.getElementById('cID').value,
                ad: document.getElementById('cAddr').value,
                d: document.getElementById('cDevice').value,
                im: document.getElementById('cIMEI').value,
                t: document.getElementById('cTotal').value,
                m: document.getElementById('cMonth').value,
                day: document.getElementById('cDay').value,
                dt: new Date().toLocaleDateString('ar-SA'),
                tk: tk, ch: id
            };

            const link = window.location.origin + window.location.pathname + "?c=" + encode(data);
            navigator.clipboard.writeText(link).then(()=>alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!"));
        }

        function verify() {
            const ph = document.getElementById('authPhone').value.trim();
            const d = decode(cVal);
            if(d && ph.length >= 5 && d.p.includes(ph.slice(-5))) {
                document.getElementById('authView').classList.remove('active');
                renderContract(cVal, null);
            } else {
                alert("Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚");
            }
        }

        function renderContract(c, s) {
            const d = decode(c);
            document.getElementById('contractView').classList.add('active');
            
            // Fill
            document.getElementById('vName').innerText = d.n;
            document.getElementById('vID').innerText = d.id;
            document.getElementById('vPhone').innerText = d.p;
            document.getElementById('vAddr').innerText = d.ad;
            document.getElementById('vDevice').innerText = d.d;
            document.getElementById('vIMEI').innerText = d.im;
            document.getElementById('vTotal').innerText = d.t;
            document.getElementById('vMonth').innerText = d.m;
            document.getElementById('vDay').innerText = d.day;
            document.getElementById('vDate').innerText = d.dt;

            // If Signed
            if(s) {
                const sData = decode(s);
                document.getElementById('sigBox').style.display = 'none';
                document.getElementById('signedStamp').style.display = 'block';
                document.getElementById('finalSig').innerText = sData.n;
                
                // Show Print Button & Auto Print
                const printBtn = document.getElementById('adminPrintBtn');
                printBtn.style.display = 'flex';
                
                // Auto Print after 1 second (give time to render)
                setTimeout(() => {
                    // window.print(); // Uncomment this if you want it to force open immediately
                }, 1000);
            }
        }

        function sign() {
            const name = document.getElementById('sigInput').value;
            if(name.length < 5) return alert("Ø§Ù„Ø§Ø³Ù… Ù‚ØµÙŠØ±");
            
            const d = decode(cVal);
            const sData = { n: name, ts: Date.now() };
            const fullLink = window.location.origin + window.location.pathname + "?c=" + cVal + "&s=" + encode(sData);
            
            const msg = `âœ… *ØªÙ… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ (Ù…Ø­Ø²Ù…)*\nğŸ‘¤ ${d.n}\nğŸ“± ${d.d}\n\nğŸ“„ [Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©](${fullLink})`;

            if(d.tk && d.ch) {
                fetch(`https://api.telegram.org/bot${d.tk}/sendMessage`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ chat_id: d.ch, text: msg, parse_mode: 'Markdown' })
                });
            }
            
            document.getElementById('contractView').classList.remove('active');
            document.getElementById('successView').classList.add('active');
        }
    </script>
</body>
</html>
